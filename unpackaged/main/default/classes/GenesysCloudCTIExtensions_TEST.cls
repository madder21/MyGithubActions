@isTest
public class GenesysCloudCTIExtensions_TEST {
    
	// Create a mock class that implements the HttpCalloutMock interface
    public class MyMockHttpResponseOnScreenPop implements HttpCalloutMock {
    	public HTTPResponse respond(HTTPRequest req) {
        	// Generate a mock HTTP response
            HTTPResponse res = new HTTPResponse();
            res.setHeader('Content-Type', 'application/json');
            res.setBody('{address=tel:+3317234567, divisions=({division={id=a13fa3e0-9908-4df2-a3b0-57555a50909e, selfUri=/api/v2/authorization/divisions/a13fa3e0-9908-4df2-a3b0-57555a50909e}, entities=({id=7b6b1865-07ed-4e2e-a0ed-ada2b29c2205, selfUri=/api/v2/flows/7b6b1865-07ed-4e2e-a0ed-ada2b29c2205})}, {division={id=612c89ba-3ea3-4018-b53d-050bd3638137, selfUri=/api/v2/authorization/divisions/612c89ba-3ea3-4018-b53d-050bd3638137}, entities=({id=cb19e79e-3fc0-4d92-8d0c-cf665d55ccee, selfUri=/api/v2/flows/cb19e79e-3fc0-4d92-8d0c-cf665d55ccee}, {id=b6011999-e6dc-424e-b1cf-ddbd5dbe1736, selfUri=/api/v2/flows/b6011999-e6dc-424e-b1cf-ddbd5dbe1736}, {id=0a505ff4-c4c4-4e81-8b8a-6cd2d5a905f7, selfUri=/api/v2/users/0a505ff4-c4c4-4e81-8b8a-6cd2d5a905f7})}, {division={id=b7efc4f5-c3b0-44e2-8784-935ab8ae1c3f, selfUri=/api/v2/authorization/divisions/b7efc4f5-c3b0-44e2-8784-935ab8ae1c3f}, entities=({id=0f3117f3-fd8c-4804-ab09-ff0e410c5d50, selfUri=/api/v2/routing/queues/0f3117f3-fd8c-4804-ab09-ff0e410c5d50})}), id=9828b14a-2057-429b-9449-09d8ec516258, participants=({address=tel:+33647938584, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={BI_CCR_External=false, BI_CSCStatus=Open, BI_Callrecording=true, BI_DNIS=+33176432924, BI_Deterence=false, BI_HubO=EU, BI_IsProd=false, BI_Language=en-gb}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:13.894Z, direction=inbound, disconnectReasons=(), held=false, id=c2c39914-3d73-48ad-8afd-0fa790e2a920, initialState=offering, muted=false}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:13.894Z, dnis=tel:+33176432924}, {address=sip:72d8c8c0-29a8-4754-945b-a92f4a033413@127.0.0.1;language=en-US;user=ivr, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:13.854Z, direction=inbound, disconnectReasons=({code=410, phrase=Gone, type=sip}), disconnectType=transfer, disconnectedTime=2023-08-31T09:42:14.330Z, held=false, id=e9d05fdc-75d7-48a1-becf-4ec28cab9f92}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:13.854Z, dnis=sip:72d8c8c0-29a8-4754-945b-a92f4a033413@127.0.0.1;language=en-US;user=ivr}, {address=sip:40c24a57-b4bf-474e-9a85-9052b25708d5@127.0.0.1;language=en-US;user=ivr, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:14.325Z, direction=inbound, disconnectReasons=(), disconnectType=transfer, disconnectedTime=2023-08-31T09:42:26.138Z, held=false, id=0581d25f-0ca0-40a6-a315-3a01382b2774}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:14.325Z, dnis=sip:40c24a57-b4bf-474e-9a85-9052b25708d5@127.0.0.1;language=en-US;user=ivr}, {address=sip:0f3117f3-fd8c-4804-ab09-ff0e410c5d50@127.0.0.1;language=en-GB;src=https://edge-proxy.eu-central-1.mypurecloud.de/connector/v1/organizations/955dd2b0-ca50-4d62-ae0b-c6ec1639eac0/defaults/ivr/1df2a51b-d8d0-4dfd-ba59-0bb3c80ea850/defaultentrypoint.vxml;user=acd, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={ivr.Skills=6bddbe80-0506-44ea-bbca-b577a42c1795}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:26.200Z, direction=inbound, disconnectReasons=(), held=false, id=682ba5da-9adc-4d75-a6bf-907ce278ad47, initialState=offering, muted=false}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:26.200Z, conversationRoutingData={priority=0, queue={id=0f3117f3-fd8c-4804-ab09-ff0e410c5d50, selfUri=/api/v2/routing/queues/0f3117f3-fd8c-4804-ab09-ff0e410c5d50}, scoredAgents=(), skills=({id=6bddbe80-0506-44ea-bbca-b577a42c1795, selfUri=/api/v2/routing/skills/6bddbe80-0506-44ea-bbca-b577a42c1795})}}, {address=sip:63e0bc9ca33d4e1bf4f6f550+lvmhcs.orgspan.com;tgrp=0a22345a-5129-482e-acc6-e185d7d0a837;trunk-context=lvmhcs@localhost, alertingTimeoutMs=8000, ani=sip:+33647938584@10.72.9.170;user=phone, aniName=Mobile Number, France, attributes={}, calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, direction=inbound, disconnectReasons=(), held=false, id=d273f618-4390-4a82-b836-042b1fbcf673, initialState=alerting, muted=false, other={addressDisplayable=unavailable, addressNormalized=sip:+33647938584@10.72.9.170;user=phone, addressRaw=sip:+33647938584@10.72.9.170;user=phone, name=Mobile Number, France, nameRaw=Mobile Number, France}}), dnis=sip:63e0bc9ca33d4e1bf4f6f550+lvmhcs.orgspan.com;tgrp=0a22345a-5129-482e-acc6-e185d7d0a837;trunk-context=lvmhcs@localhost, id=e045d32e-f051-4a3d-891b-2a78ac788087, mediaRoles=(full), name=Alexis Houpert}), recentTransfers=({dateIssued=2023-08-31T09:42:26.464Z, destination={address=sip:a.houpert%40lvmhcs.com@localhost, userId=0a505ff4-c4c4-4e81-8b8a-6cd2d5a905f7}, id=b1d1c777-29ee-4d43-acb1-c293df162251, initiator={}, modifiedBy={}, state=Active, transferType=Attended}), recordingState=ACTIVE, securePause=false, selfUri=/api/v2/conversations/9828b14a-2057-429b-9449-09d8ec516258, startTime=2023-08-31T09:42:13.837Z}');
            res.setStatusCode(200);
            return res;
        }
    }
    
	// Create a mock class that implements the HttpCalloutMock interface
	public class MyMockHttpResponseOnSaveLog implements HttpCalloutMock {
		public HTTPResponse respond(HTTPRequest req) {
			// Generate a mock HTTP response
            HTTPResponse res = new HTTPResponse();
            res.setHeader('Content-Type', 'application/json');
            res.setBody('{address=tel:+3317234567, divisions=({division={id=a13fa3e0-9908-4df2-a3b0-57555a50909e, selfUri=/api/v2/authorization/divisions/a13fa3e0-9908-4df2-a3b0-57555a50909e}, entities=({id=7b6b1865-07ed-4e2e-a0ed-ada2b29c2205, selfUri=/api/v2/flows/7b6b1865-07ed-4e2e-a0ed-ada2b29c2205})}, {division={id=612c89ba-3ea3-4018-b53d-050bd3638137, selfUri=/api/v2/authorization/divisions/612c89ba-3ea3-4018-b53d-050bd3638137}, entities=({id=cb19e79e-3fc0-4d92-8d0c-cf665d55ccee, selfUri=/api/v2/flows/cb19e79e-3fc0-4d92-8d0c-cf665d55ccee}, {id=b6011999-e6dc-424e-b1cf-ddbd5dbe1736, selfUri=/api/v2/flows/b6011999-e6dc-424e-b1cf-ddbd5dbe1736}, {id=0a505ff4-c4c4-4e81-8b8a-6cd2d5a905f7, selfUri=/api/v2/users/0a505ff4-c4c4-4e81-8b8a-6cd2d5a905f7})}, {division={id=b7efc4f5-c3b0-44e2-8784-935ab8ae1c3f, selfUri=/api/v2/authorization/divisions/b7efc4f5-c3b0-44e2-8784-935ab8ae1c3f}, entities=({id=0f3117f3-fd8c-4804-ab09-ff0e410c5d50, selfUri=/api/v2/routing/queues/0f3117f3-fd8c-4804-ab09-ff0e410c5d50})}), id=9828b14a-2057-429b-9449-09d8ec516258, participants=({address=tel:+33647938584, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={BI_CCR_External=false, BI_CSCStatus=Open, BI_Callrecording=true, BI_DNIS=+33176432924, BI_Deterence=false, BI_HubO=EU, BI_IsProd=false, BI_Language=en-gb}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:13.894Z, direction=inbound, disconnectReasons=(), held=false, id=c2c39914-3d73-48ad-8afd-0fa790e2a920, initialState=offering, muted=false}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:13.894Z, dnis=tel:+33176432924}, {address=sip:72d8c8c0-29a8-4754-945b-a92f4a033413@127.0.0.1;language=en-US;user=ivr, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:13.854Z, direction=inbound, disconnectReasons=({code=410, phrase=Gone, type=sip}), disconnectType=transfer, disconnectedTime=2023-08-31T09:42:14.330Z, held=false, id=e9d05fdc-75d7-48a1-becf-4ec28cab9f92}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:13.854Z, dnis=sip:72d8c8c0-29a8-4754-945b-a92f4a033413@127.0.0.1;language=en-US;user=ivr}, {address=sip:40c24a57-b4bf-474e-9a85-9052b25708d5@127.0.0.1;language=en-US;user=ivr, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:14.325Z, direction=inbound, disconnectReasons=(), disconnectType=transfer, disconnectedTime=2023-08-31T09:42:26.138Z, held=false, id=0581d25f-0ca0-40a6-a315-3a01382b2774}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:14.325Z, dnis=sip:40c24a57-b4bf-474e-9a85-9052b25708d5@127.0.0.1;language=en-US;user=ivr}, {address=sip:0f3117f3-fd8c-4804-ab09-ff0e410c5d50@127.0.0.1;language=en-GB;src=https://edge-proxy.eu-central-1.mypurecloud.de/connector/v1/organizations/955dd2b0-ca50-4d62-ae0b-c6ec1639eac0/defaults/ivr/1df2a51b-d8d0-4dfd-ba59-0bb3c80ea850/defaultentrypoint.vxml;user=acd, ani=tel:+33647938584, aniName=Mobile Number, France, attributes={ivr.Skills=6bddbe80-0506-44ea-bbca-b577a42c1795}, callbacks=(), calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, connectedTime=2023-08-31T09:42:26.200Z, direction=inbound, disconnectReasons=(), held=false, id=682ba5da-9adc-4d75-a6bf-907ce278ad47, initialState=offering, muted=false}), chats=(), cobrowsesessions=(), connectedTime=2023-08-31T09:42:26.200Z, conversationRoutingData={priority=0, queue={id=0f3117f3-fd8c-4804-ab09-ff0e410c5d50, selfUri=/api/v2/routing/queues/0f3117f3-fd8c-4804-ab09-ff0e410c5d50}, scoredAgents=(), skills=({id=6bddbe80-0506-44ea-bbca-b577a42c1795, selfUri=/api/v2/routing/skills/6bddbe80-0506-44ea-bbca-b577a42c1795})}}, {address=sip:63e0bc9ca33d4e1bf4f6f550+lvmhcs.orgspan.com;tgrp=0a22345a-5129-482e-acc6-e185d7d0a837;trunk-context=lvmhcs@localhost, alertingTimeoutMs=8000, ani=sip:+33647938584@10.72.9.170;user=phone, aniName=Mobile Number, France, attributes={}, calls=({afterCallWork={}, afterCallWorkRequired=false, confined=false, direction=inbound, disconnectReasons=(), held=false, id=d273f618-4390-4a82-b836-042b1fbcf673, initialState=alerting, muted=false, other={addressDisplayable=unavailable, addressNormalized=sip:+33647938584@10.72.9.170;user=phone, addressRaw=sip:+33647938584@10.72.9.170;user=phone, name=Mobile Number, France, nameRaw=Mobile Number, France}}), dnis=sip:63e0bc9ca33d4e1bf4f6f550+lvmhcs.orgspan.com;tgrp=0a22345a-5129-482e-acc6-e185d7d0a837;trunk-context=lvmhcs@localhost, id=e045d32e-f051-4a3d-891b-2a78ac788087, mediaRoles=(full), name=Alexis Houpert}), recentTransfers=({dateIssued=2023-08-31T09:42:26.464Z, destination={address=sip:a.houpert%40lvmhcs.com@localhost, userId=0a505ff4-c4c4-4e81-8b8a-6cd2d5a905f7}, id=b1d1c777-29ee-4d43-acb1-c293df162251, initiator={}, modifiedBy={}, state=Active, transferType=Attended}), recordingState=ACTIVE, securePause=false, selfUri=/api/v2/conversations/9828b14a-2057-429b-9449-09d8ec516258, startTime=2023-08-31T09:42:13.837Z}');
            res.setStatusCode(200);
            return res;
		}
    }
    
    @isTest
    static void testOnClickToDial() {
        // Create the instance of the class being tested
        GenesysCloudCTIExtensions ctiExtensions = new GenesysCloudCTIExtensions();
                
        // Prepare test data (JSON String) to simulate the input
        Map<String, Object> testDataMap = new Map<String, Object>();
        testDataMap.put('queueId', 'Fake ID');

        // Serialize the test data map to JSON     
        String testDataJSON = JSON.serialize(testDataMap);
        // Call the onClickToDial method with the test data        
        String result = ctiExtensions.onClickToDial(testDataJSON);
                
        System.assertEquals(testDataJSON, result, 'Class:GenesysCloudCTIExtensions_TEST - Method:testOnClickToDial() -- onClickToDial method should return the modified JSON data');
    }
    
    @isTest
	public static void testOnScreenPop() {
		Test.startTest();
		String data = '{"callLog":{"ActivityDate":"2023-8-30","Type":"Call","CallObject":"e30f2afd-b189-4591-8c9b-7d7949970214","CallType":"Inbound","Status":"Completed","Call_Is_Recorded__c":"true","Call_GUID__c":"e30f2afd-b189-4591-8c9b-7d7949970214","External_Transfert__c":"false","Hub_Origin__c":"EU","csc_market__c":"","Service_Name__c":"LVMH Ecom UK Hub EU","Queue__c":"UAT LVMH Ecom UK","Customer_Number__c":"+336666666666","subject":"Call 30/08/2023 10:52:32"},"interaction":{"state":"CONNECTED","isDone":false,"isDisconnected":false,"isConnected":true,"name":"Mobile Number, France","phone":"tel:+336666666666","connectedTime":"2023-08-30T08:52:32.533Z","id":"e30f2afd-b189-4591-8c9b-7d7949970214"}}';
		Test.setMock(HttpCalloutMock.class, new MyMockHttpResponseOnScreenPop());
		// Create an instance of the class being tested
		GenesysCloudCTIExtensions ctiExtensions = new GenesysCloudCTIExtensions();
		ctiExtensions.onScreenPop(data);
		Test.stopTest();
    }   
     
    @isTest
	public static void testOnSaveLog() {
		Test.startTest();
		String data ='{"callLog":{"ActivityDate":"2023-8-30","Type":"Call","CallObject":"e30f2afd-b189-4591-8c9b-7d7949970214","CallType":"Inbound","Status":"Completed","Call_Is_Recorded__c":"true","Call_GUID__c":"e30f2afd-b189-4591-8c9b-7d7949970214","External_Transfert__c":"false","Hub_Origin__c":"EU","csc_market__c":"","Service_Name__c":"LVMH Ecom UK Hub EU","Queue__c":"UAT LVMH Ecom UK","Customer_Number__c":"+336666666666","subject":"Call 30/08/2023 10:52:32"},"interaction":{"state":"CONNECTED","isDone":false,"isDisconnected":false,"isConnected":true,"name":"Mobile Number, France","phone":"tel:+336666666666","connectedTime":"2023-08-30T08:52:32.533Z","id":"e30f2afd-b189-4591-8c9b-7d7949970214"}}';
		Test.setMock(HttpCalloutMock.class, new MyMockHttpResponseOnSaveLog());
		// Create the instance of the class being tested
		GenesysCloudCTIExtensions ctiExtensions = new GenesysCloudCTIExtensions();
		ctiExtensions.onSaveLog(data);
        Test.stopTest();
    }
}