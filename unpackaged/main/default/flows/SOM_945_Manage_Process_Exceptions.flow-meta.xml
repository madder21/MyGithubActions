<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>57.0</apiVersion>
    <assignments>
        <name>Add_1_PE</name>
        <label>Add + 1 PE</label>
        <locationX>2049</locationX>
        <locationY>256</locationY>
        <assignmentItems>
            <assignToReference>Current_OSLI.Unresolved_PEs__c</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_OSLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Count_1</name>
        <label>Add Count +1</label>
        <locationX>1278</locationX>
        <locationY>50</locationY>
        <assignmentItems>
            <assignToReference>V01_Count_PE</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>L10_Process_Exceptions_Results</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>assign_number_of_PE_to_unresolved_PE</name>
        <label>assign number of PE to unresolved PE</label>
        <locationX>2124</locationX>
        <locationY>877</locationY>
        <assignmentItems>
            <assignToReference>counter_PE</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>get_PE_resolved</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Substract_1_PE</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Tech_Brazil_Value</name>
        <label>Assign Tech Brazil Value</label>
        <locationX>472</locationX>
        <locationY>661</locationY>
        <assignmentItems>
            <assignToReference>Tech_OSAddressValidation_Brazil</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Address_PE</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Substract_1_PE</name>
        <label>Substract -1 PE</label>
        <locationX>2373</locationX>
        <locationY>779</locationY>
        <assignmentItems>
            <assignToReference>Current_OSLI.Unresolved_PEs__c</assignToReference>
            <operator>Subtract</operator>
            <value>
                <elementReference>counter_PE</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_OSLI</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_PE_for_AddressValidation</name>
        <label>Check PE for AddressValidation</label>
        <locationX>50</locationX>
        <locationY>654</locationY>
        <defaultConnector>
            <targetReference>Loop_Over_Address_PE</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>false</name>
            <conditionLogic>1 AND 4 AND NOT ( 5 ) AND (2 OR 3)</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Category</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Address Validation Brazil</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Message</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Shipping Address : INVALID ADDRESS</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Message</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Billing Address : INVALID ADDRESS</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Description</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <stringValue>The postal code is not recognized.</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Tech_Brazil_Value</targetReference>
            </connector>
            <label>false</label>
        </rules>
        <rules>
            <name>true</name>
            <conditionLogic>1 AND 4 AND 5  AND (2 OR 3)</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Category</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Address Validation Brazil</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Message</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Shipping Address : INVALID ADDRESS</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Message</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Billing Address : INVALID ADDRESS</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_Over_Address_PE.Description</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <stringValue>The postal code is not recognized.</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_ISOCode</targetReference>
            </connector>
            <label>true</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Related_PE</name>
        <label>Check Related PE</label>
        <locationX>630</locationX>
        <locationY>513</locationY>
        <defaultConnector>
            <targetReference>Update_OS_TechOS_AddressValidation</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_PE_CheckAddress</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Over_Address_PE</targetReference>
            </connector>
            <label>Exists</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_New</name>
        <label>Is New ?</label>
        <locationX>1724</locationX>
        <locationY>426</locationY>
        <defaultConnector>
            <targetReference>Status_has_changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not new</defaultConnectorLabel>
        <rules>
            <name>Yes_is_New</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>FX_Isnew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Resolved_or_not</targetReference>
            </connector>
            <label>Yes is New</label>
        </rules>
    </decisions>
    <decisions>
        <name>New_PE_Type_Fulfillment_Exist</name>
        <label>New PE Type Fulfillment Exist?</label>
        <locationX>1271</locationX>
        <locationY>432</locationY>
        <defaultConnector>
            <targetReference>Update_tech_PE_Fulfillment_Count_c_in_OS</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Process_Exceptions_Fulfillment_per_OS</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>L10_Process_Exceptions_Results</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Order Summary Line Item</description>
        <name>Related_to_OSLI</name>
        <label>Related to OSLI ?</label>
        <locationX>1017</locationX>
        <locationY>641</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_related_to_OSLI</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.AttachedToId</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <stringValue>10u</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_OSLI</targetReference>
            </connector>
            <label>Yes related to OSLI</label>
        </rules>
    </decisions>
    <decisions>
        <name>Resolved_or_not</name>
        <label>Resolved or not ?</label>
        <locationX>1724</locationX>
        <locationY>259</locationY>
        <defaultConnectorLabel>Resolved</defaultConnectorLabel>
        <rules>
            <name>Not_Resolved_yet</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StatusCategory</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>RESOLVED</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_1_PE</targetReference>
            </connector>
            <label>Not Resolved yet</label>
        </rules>
    </decisions>
    <decisions>
        <name>Status_has_changed</name>
        <label>Status has changed</label>
        <locationX>1721</locationX>
        <locationY>655</locationY>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>Changed_to_Resolved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StatusCategory</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>RESOLVED</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StatusCategory</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>RESOLVED</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>get_PE_resolved</targetReference>
            </connector>
            <label>Changed to Resolved</label>
        </rules>
        <rules>
            <name>Changed_to_unresolved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StatusCategory</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>RESOLVED</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StatusCategory</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>RESOLVED</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_1_PE</targetReference>
            </connector>
            <label>Changed to unresolved</label>
        </rules>
    </decisions>
    <decisions>
        <name>Update_ISOCode</name>
        <label>Update ISOCode</label>
        <locationX>614</locationX>
        <locationY>822</locationY>
        <defaultConnector>
            <targetReference>Related_to_OSLI</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>IsNewlyCreated</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>IsCreated</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_OrderSummary</targetReference>
            </connector>
            <label>IsNewlyCreated</label>
        </rules>
    </decisions>
    <description>Update Address Validation</description>
    <environments>Default</environments>
    <formulas>
        <name>FX_Isnew</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <formulas>
        <name>FX_Plus_One</name>
        <dataType>Number</dataType>
        <expression>+1</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>IsCreated</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <interviewLabel>SOM 945 - Manage Process Exceptions {!$Flow.CurrentDateTime}</interviewLabel>
    <label>SOM 945 - Manage Process Exceptions</label>
    <loops>
        <name>L10_Process_Exceptions_Results</name>
        <label>L10 Process Exceptions Results</label>
        <locationX>1279</locationX>
        <locationY>231</locationY>
        <collectionReference>Get_Process_Exceptions_Fulfillment_per_OS</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Count_1</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_tech_PE_Fulfillment_Count_c_in_OS</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Over_Address_PE</name>
        <label>Loop Over Address PE</label>
        <locationX>479</locationX>
        <locationY>470</locationY>
        <collectionReference>Get_PE_CheckAddress</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Check_PE_for_AddressValidation</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_OS_TechOS_AddressValidation</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_OrderSummary</name>
        <label>Get OrderSummary</label>
        <locationX>897</locationX>
        <locationY>824</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Currency_Iso_Code</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.OrderSummaryId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>OrderSummary</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_OSLI</name>
        <label>Get OSLI</label>
        <locationX>1020</locationX>
        <locationY>431</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Process_Exceptions_Fulfillment_per_OS</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AttachedToId</elementReference>
            </value>
        </filters>
        <object>OrderItemSummary</object>
        <outputReference>Current_OSLI</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Unresolved_PEs__c</queriedFields>
        <queriedFields>OrderSummaryId</queriedFields>
        <sortField>Id</sortField>
        <sortOrder>Asc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_PE_CheckAddress</name>
        <label>Get PE CheckAddress</label>
        <locationX>788</locationX>
        <locationY>421</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Related_PE</targetReference>
        </connector>
        <filterLogic>1 AND 2 AND( 3 OR 4 )</filterLogic>
        <filters>
            <field>OrderSummaryId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.OrderSummaryId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Category</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Address Validation Brazil</stringValue>
            </value>
        </filters>
        <filters>
            <field>Message</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Shipping Address : INVALID ADDRESS</stringValue>
            </value>
        </filters>
        <filters>
            <field>Message</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Billing Address : INVALID ADDRESS</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ProcessException</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>get_PE_resolved</name>
        <label>get PE resolved</label>
        <locationX>1879</locationX>
        <locationY>822</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>assign_number_of_PE_to_unresolved_PE</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Resolved</stringValue>
            </value>
        </filters>
        <filters>
            <field>Category</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Fulfillment</stringValue>
            </value>
        </filters>
        <filters>
            <field>AttachedToId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Current_OSLI.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ProcessException</object>
        <queriedFields>Id</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Process_Exceptions_Fulfillment_per_OS</name>
        <label>Get Process Exceptions (Fulfillment) per OS</label>
        <locationX>1135</locationX>
        <locationY>430</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>New_PE_Type_Fulfillment_Exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OrderSummaryId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Current_OSLI.OrderSummary.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Category</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Fulfillment</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>New</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ProcessException</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Currency_Iso_Code</name>
        <label>Update Currency Iso Code</label>
        <locationX>1037</locationX>
        <locationY>819</locationY>
        <connector>
            <targetReference>Related_to_OSLI</targetReference>
        </connector>
        <inputAssignments>
            <field>CurrencyIsoCode</field>
            <value>
                <elementReference>Get_OrderSummary.CurrencyIsoCode</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_OS_TechOS_AddressValidation</name>
        <label>Update OS TechOS_AddressValidation</label>
        <locationX>625</locationX>
        <locationY>668</locationY>
        <connector>
            <targetReference>Update_ISOCode</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.OrderSummaryId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Tech_PE_DisplayButton__c</field>
            <value>
                <elementReference>Tech_OSAddressValidation_Brazil</elementReference>
            </value>
        </inputAssignments>
        <object>OrderSummary</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_OSLI</name>
        <label>Update OSLI</label>
        <locationX>2373</locationX>
        <locationY>257</locationY>
        <inputReference>Current_OSLI</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_tech_PE_Fulfillment_Count_c_in_OS</name>
        <label>Update tech_PE_Fulfillment_Count__c in OS</label>
        <locationX>1539</locationX>
        <locationY>424</locationY>
        <connector>
            <targetReference>Is_New</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Current_OSLI.OrderSummary.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>tech_PE_Fulfillment_Count__c</field>
            <value>
                <elementReference>V01_Count_PE</elementReference>
            </value>
        </inputAssignments>
        <object>OrderSummary</object>
    </recordUpdates>
    <start>
        <locationX>662</locationX>
        <locationY>136</locationY>
        <connector>
            <targetReference>Get_PE_CheckAddress</targetReference>
        </connector>
        <object>ProcessException</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>counter_PE</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>Current_OSLI</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OrderItemSummary</objectType>
    </variables>
    <variables>
        <name>Tech_OSAddressValidation_Brazil</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>true</booleanValue>
        </value>
    </variables>
    <variables>
        <name>V01_Count_PE</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
